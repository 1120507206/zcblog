(window.webpackJsonp=window.webpackJsonp||[]).push([[144],{505:function(t,s,a){"use strict";a.r(s);var n=a(7),e=Object(n.a)({},(function(){var t=this,s=t._self._c;return s("ContentSlotsDistributor",{attrs:{"slot-key":t.$parent.slotKey}},[s("p",[t._v("事件循环，面试高频考点")]),t._v(" "),s("p",[t._v("要弄清楚事件循环，先弄懂栈的概念：")]),t._v(" "),s("h3",{attrs:{id:"栈-stack"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#栈-stack"}},[t._v("#")]),t._v(" 栈（Stack）")]),t._v(" "),s("p",[t._v("用通俗的语言来说栈就是一种数据结构，按照"),s("strong",[t._v("后进先出")]),t._v("的原则。")]),t._v(" "),s("p",[s("img",{attrs:{src:"image/09.%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/1684220956375.png",alt:"1684220956375"}})]),t._v(" "),s("h3",{attrs:{id:"队列-queue"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#队列-queue"}},[t._v("#")]),t._v(" 队列（Queue）")]),t._v(" "),s("p",[t._v("队列和栈的概念刚好相反，  "),s("strong",[t._v("队列")]),t._v("的数据元素又称为 "),s("strong",[t._v("队列元素")]),t._v(" 。在队列中插入一个队列元素称为 "),s("strong",[t._v("入队")]),t._v(" ，从"),s("strong",[t._v("队列")]),t._v("中"),s("strong",[t._v("删除")]),t._v("一个队列元素称为 "),s("strong",[t._v("出队")]),t._v(" 。因为队列"),s("strong",[t._v("只允许")]),t._v("在一端 "),s("strong",[t._v("插入")]),t._v(" ，在另一端 "),s("strong",[t._v("删除")]),t._v(" ，所以只有"),s("strong",[t._v("最早")]),t._v("进入"),s("strong",[t._v("队列")]),t._v("的元素"),s("strong",[t._v("才能最先从队列中")]),t._v("删除，故队列又称为 "),s("strong",[t._v("先进先出")]),t._v(" （"),s("code",[t._v("FIFO—first in first out")]),t._v("）")]),t._v(" "),s("p",[s("img",{attrs:{src:"image/09.%E4%BA%8B%E4%BB%B6%E5%BE%AA%E7%8E%AF/1684221065298.png",alt:"1684221065298"}})]),t._v(" "),s("p",[t._v("好了，接下来说回事件循环，事件循环也叫event Loop")]),t._v(" "),s("p",[t._v("在 "),s("code",[t._v("JavaScript")]),t._v("中，任务被分为两种，一种宏任务（"),s("code",[t._v("MacroTask")]),t._v("）也叫 "),s("code",[t._v("Task")]),t._v("，一种叫微任务（"),s("code",[t._v("MicroTask")]),t._v("）。")]),t._v(" "),s("h3",{attrs:{id:"macrotask-宏任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#macrotask-宏任务"}},[t._v("#")]),t._v(" MacroTask（宏任务）")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("script")]),t._v("全部代码、"),s("code",[t._v("setTimeout")]),t._v("、"),s("code",[t._v("setInterval")]),t._v("、"),s("code",[t._v("setImmediate")]),t._v("（浏览器暂时不支持，只有IE10支持，具体可见"),s("a",{attrs:{href:"https://link.juejin.cn/?target=https%3A%2F%2Fdeveloper.mozilla.org%2Fzh-CN%2Fdocs%2FWeb%2FAPI%2FWindow%2FsetImmediate",title:"https://developer.mozilla.org/zh-CN/docs/Web/API/Window/setImmediate",target:"_blank",rel:"noopener noreferrer"}},[s("code",[t._v("MDN")]),s("OutboundLink")],1),t._v("）、"),s("code",[t._v("I/O")]),t._v("、"),s("code",[t._v("UI Rendering")]),t._v("。")])]),t._v(" "),s("h3",{attrs:{id:"microtask-微任务"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#microtask-微任务"}},[t._v("#")]),t._v(" MicroTask（微任务）")]),t._v(" "),s("ul",[s("li",[s("code",[t._v("Process.nextTick（Node独有）")]),t._v("、"),s("code",[t._v("Promise")]),t._v("、"),s("code",[t._v("Object.observe(废弃)")]),t._v("、"),s("code",[t._v("MutationObserver")])])]),t._v(" "),s("p",[s("code",[t._v("Javascript")]),t._v(" 有一个 "),s("code",[t._v("main thread")]),t._v(" 主线程和 "),s("code",[t._v("call-stack")]),t._v(" 调用栈(执行栈)，所有的任务都会被放到调用栈等待主线程执行。")]),t._v(" "),s("h3",{attrs:{id:"js调用栈"}},[s("a",{staticClass:"header-anchor",attrs:{href:"#js调用栈"}},[t._v("#")]),t._v(" JS调用栈")]),t._v(" "),s("p",[t._v("JS调用栈采用的是后进先出的规则，当函数执行的时候，会被添加到栈的顶部，当执行栈执行完成后，就会从栈顶移出，直到栈内被清空。")]),t._v(" "),s("p",[t._v("在JavaScript中，宏任务和微任务的执行顺序是不同的，微任务会在宏任务执行完成后立即执行。具体的说，以下是它们执行的顺序：")]),t._v(" "),s("ol",[s("li",[t._v("当主线程执行完一个宏任务后，会检查该宏任务中是否有微任务，如果有则立即执行所有微任务，直到微任务队列为空。")]),t._v(" "),s("li",[t._v("当执行完所有的微任务之后，主线程会从宏任务队列中检索并执行下一个宏任务。")]),t._v(" "),s("li",[t._v("如果在当前执行宏任务的过程中产生了新的微任务，则将这些微任务添加到微任务队列的末尾。在宏任务执行完成后，将立即执行这些微任务。")]),t._v(" "),s("li",[t._v("微任务可以嵌套其他微任务，直到队列为空为止。如果有多个微任务，则它们按照添加到队列中的顺序依次执行。")])]),t._v(" "),s("p",[t._v("因此，微任务总是在同一次事件循环中执行，而宏任务的执行周期取决于它们被添加到队列中的时间。")]),t._v(" "),s("p",[t._v("例子：")]),t._v(" "),s("div",{staticClass:"language-javascript line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-javascript"}},[s("code",[t._v("console"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'start'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\n"),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("setTimeout")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'setTimeout'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(",")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token number"}},[t._v("0")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v("\n\nPromise"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("resolve")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise1'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("then")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token keyword"}},[t._v("function")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),t._v(" "),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("{")]),t._v("\nconsole"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(".")]),s("span",{pre:!0,attrs:{class:"token function"}},[t._v("log")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("(")]),s("span",{pre:!0,attrs:{class:"token string"}},[t._v("'promise2'")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n"),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v("}")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(")")]),s("span",{pre:!0,attrs:{class:"token punctuation"}},[t._v(";")]),t._v("\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br"),s("span",{staticClass:"line-number"},[t._v("6")]),s("br"),s("span",{staticClass:"line-number"},[t._v("7")]),s("br"),s("span",{staticClass:"line-number"},[t._v("8")]),s("br"),s("span",{staticClass:"line-number"},[t._v("9")]),s("br"),s("span",{staticClass:"line-number"},[t._v("10")]),s("br"),s("span",{staticClass:"line-number"},[t._v("11")]),s("br")])]),s("p",[t._v("浏览器中，上述代码的打印结果为：")]),t._v(" "),s("div",{staticClass:"language- line-numbers-mode"},[s("pre",{pre:!0,attrs:{class:"language-text"}},[s("code",[t._v("start\nend\npromise1\npromise2\nsetTimeout\n")])]),t._v(" "),s("div",{staticClass:"line-numbers-wrapper"},[s("span",{staticClass:"line-number"},[t._v("1")]),s("br"),s("span",{staticClass:"line-number"},[t._v("2")]),s("br"),s("span",{staticClass:"line-number"},[t._v("3")]),s("br"),s("span",{staticClass:"line-number"},[t._v("4")]),s("br"),s("span",{staticClass:"line-number"},[t._v("5")]),s("br")])]),s("p",[t._v("解释：")]),t._v(" "),s("ol",[s("li",[t._v("首先，主程序线程同步执行 "),s("code",[t._v("console.log('start')")]),t._v("和 "),s("code",[t._v("console.log('end')")]),t._v("，将其先输出。")]),t._v(" "),s("li",[t._v("然后，"),s("code",[t._v("setTimeout()")]),t._v("方法被添加到任务队列的末尾，等待主程序线程执行完成并返回控制权。")]),t._v(" "),s("li",[t._v("接着，Promise对象被创建并添加到微任务队列中，由于无延迟要求，因此立即执行。因此，"),s("code",[t._v("console.log('promise1')")]),t._v("会被输出。紧接着，第二个微任务 "),s("code",[t._v("then")]),t._v("被添加到微任务队列中，并在当前微任务执行完成之后执行。")]),t._v(" "),s("li",[t._v("因此，"),s("code",[t._v("console.log('promise2')")]),t._v("被输出。")]),t._v(" "),s("li",[t._v("接下来，执行完所有的微任务之后，主程序线程从宏任务队列中检索并执行下一个宏任务，即 "),s("code",[t._v("setTimeout()")]),t._v("方法。由于 "),s("code",[t._v("setTimeout()")]),t._v("的延迟被设置为零，因此它会立即被执行，输出 "),s("code",[t._v("console.log('setTimeout')")]),t._v("。")])]),t._v(" "),s("p",[t._v("因此，上述代码的输出顺序为 "),s("code",[t._v("start")]),t._v("、"),s("code",[t._v("end")]),t._v("、"),s("code",[t._v("promise1")]),t._v("、"),s("code",[t._v("promise2")]),t._v("、"),s("code",[t._v("setTimeout")]),t._v("。")])])}),[],!1,null,null,null);s.default=e.exports}}]);